<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Follow the Dot | ‡∏ù‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏°‡∏∑‡∏≠-‡∏ï‡∏≤</title>
    <style>
        /* Shared & Base Styles */
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap');
        :root {
            --color-blue: #007AFF;
            --color-green: #34C759;
            --color-red: #FF3B30;
            --color-bg: #f0f0f0;
            --font-family: 'Sarabun', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        body {
            font-family: var(--font-family);
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
            background-color: var(--color-bg);
        }
        .settings-panel, .result-panel {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 90%;
            text-align: left;
        }
        h2 { color: var(--color-blue); font-size: 2rem; margin-top: 0; text-align: center; }
        label { display: block; margin-bottom: 15px; font-size: 1.2rem; font-weight: 700; }
        input[type="number"] { width: 100%; padding: 10px; margin-top: 5px; border: 2px solid #ccc; border-radius: 8px; font-size: 1.1rem; box-sizing: border-box; }
        .start-button, .home-button {
            background-color: var(--color-green);
            color: white;
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1.8rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.15s;
        }
        .home-button { background-color: var(--color-blue); margin-top: 10px; font-size: 1.4rem; }
        .start-button:active, .home-button:active { transform: translateY(2px); }

        /* Game Area */
        #gameArea {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: white;
            overflow: hidden;
            cursor: pointer;
        }
        .dot {
            position: absolute;
            width: 80px;
            height: 80px;
            background-color: var(--color-green);
            border-radius: 50%;
            transition: transform 0.1s;
            cursor: pointer;
            z-index: 10;
        }
        .dot:active {
            transform: scale(1.1);
        }
        .score-board {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 1.5rem;
            z-index: 20;
        }
        .result-panel p { font-size: 1.5rem; margin: 10px 0; }
        .result-panel .correct { color: var(--color-green); font-size: 2rem; }
        .result-panel .miss { color: var(--color-red); font-size: 2rem; }
    </style>
    <script src="shared.js"></script>
</head>
<body>
    <div class="settings-panel" id="settingsPanel">
        <button class="home-button" onclick="goTo('index.html')">üè† ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
        <h2>üü¢ Follow the Dot Setup</h2>
        
        <label for="gameType">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô:</label>
        <select id="gameType">
            <option value="time">‚è±Ô∏è ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)</option>
            <option value="count">üéØ ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏∏‡∏î</option>
        </select>

        <label for="durationCount">‚è±Ô∏è/üéØ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ/‡∏à‡∏∏‡∏î):</label>
        <input type="number" id="durationCount" value="60" min="10" max="100">

        <label for="dotSize">‡∏Ç‡∏ô‡∏≤‡∏î‡∏à‡∏∏‡∏î (‡∏û‡∏¥‡∏Å‡πÄ‡∏ã‡∏•, ‡∏Ñ‡πà‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ 80):</label>
        <input type="number" id="dotSize" value="80" min="40" max="120">
        
        <button class="start-button" onclick="startGame()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
    </div>

    <div id="gameArea">
        <div class="score-board">
            ‡∏ñ‡∏π‡∏Å: <span id="correctScore">0</span> | ‡∏û‡∏•‡∏≤‡∏î: <span id="missScore">0</span> 
            <span id="timerDisplay"></span>
        </div>
        </div>

    <div class="result-panel" id="resultPanel" style="display: none;">
        <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å</h2>
        <p>‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡πÑ‡∏î‡πâ **‡∏ñ‡∏π‡∏Å:** <span id="finalCorrect" class="correct"></span> ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
        <p>‡∏Ñ‡∏∏‡∏ì **‡∏û‡∏•‡∏≤‡∏î:** <span id="finalMiss" class="miss"></span> ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
        <button class="start-button" onclick="window.location.reload()">‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
        <button class="home-button" onclick="goTo('index.html')">üè† ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
    </div>

<script>
    let correctCount = 0;
    let missCount = 0;
    let isGameRunning = false;
    let gameTimer;
    let totalTarget = 0; // Target based on type (seconds or dot count)
    let gameType = 'time';

    function endGame() {
        isGameRunning = false;
        clearTimeout(gameTimer);
        beep(2);
        
        // Hide game and show results
        document.getElementById('gameArea').style.display = 'none';
        document.getElementById('finalCorrect').textContent = correctCount;
        document.getElementById('finalMiss').textContent = missCount;
        document.getElementById('resultPanel').style.display = 'block';

        // Clean up dot
        const currentDot = document.querySelector('.dot');
        if (currentDot) currentDot.remove();
    }

    function createNewDot() {
        if (!isGameRunning) return;

        const dotSize = parseInt(document.getElementById('dotSize').value);
        const area = document.getElementById('gameArea');
        const maxX = area.clientWidth - dotSize;
        const maxY = area.clientHeight - dotSize;
        
        if (maxX <= 0 || maxY <= 0) {
            toast('‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏•‡πá‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ!');
            endGame();
            return;
        }

        const x = Math.floor(Math.random() * maxX);
        const y = Math.floor(Math.random() * maxY);

        const newDot = document.createElement('div');
        newDot.className = 'dot';
        newDot.style.width = `${dotSize}px`;
        newDot.style.height = `${dotSize}px`;
        newDot.style.left = `${x}px`;
        newDot.style.top = `${y}px`;

        newDot.addEventListener('touchstart', handleDotTap, { once: true });
        newDot.addEventListener('mousedown', handleDotTap, { once: true });
        
        area.appendChild(newDot);

        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏∏‡∏î: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Ñ‡∏£‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        if (gameType === 'count' && correctCount + missCount >= totalTarget) {
            endGame();
            return;
        }

        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤: ‡πÉ‡∏´‡πâ‡∏à‡∏∏‡∏î‡∏≠‡∏¢‡∏π‡πà‡∏ã‡∏±‡∏Å‡∏û‡∏±‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡πÄ‡∏≠‡∏á (‡πÄ‡∏õ‡πá‡∏ô miss) ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡∏∞
        if (gameType === 'time') {
            gameTimer = setTimeout(() => {
                if (isGameRunning && area.contains(newDot)) {
                    missCount++;
                    updateScore();
                    newDot.remove();
                    createNewDot();
                }
            }, 1500); // 1.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏à‡∏∏‡∏î‡∏´‡∏≤‡∏¢
        }
    }

    function handleDotTap(event) {
        if (!isGameRunning) return;
        event.stopPropagation(); // ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÑ‡∏õ‡πÅ‡∏ï‡∏∞‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà body
        
        correctCount++;
        updateScore();
        this.remove(); // ‡∏•‡∏ö‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡∏∞
        
        if (gameType === 'count') {
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏∏‡∏î ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            createNewDot();
        } else {
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤ ‡πÉ‡∏´‡πâ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå timeout ‡∏Ç‡∏≠‡∏á‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà
            clearTimeout(gameTimer);
            createNewDot();
        }
    }

    function handleMissTap(event) {
        if (!isGameRunning || event.target !== document.getElementById('gameArea')) return;
        missCount++;
        updateScore();
        toast('‡∏û‡∏•‡∏≤‡∏î!');
        beep(1);
    }

    function updateScore(remainingTime) {
        document.getElementById('correctScore').textContent = correctCount;
        document.getElementById('missScore').textContent = missCount;
        
        const timerDisplay = document.getElementById('timerDisplay');
        if (gameType === 'time') {
            timerDisplay.textContent = `| ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${remainingTime} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
        } else {
            timerDisplay.textContent = `| ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà ${correctCount + missCount} / ${totalTarget}`;
        }
    }

    function startGame() {
        gameType = document.getElementById('gameType').value;
        totalTarget = parseInt(document.getElementById('durationCount').value);

        if (isNaN(totalTarget) || totalTarget < 1) {
            toast('‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
            return;
        }

        // Reset
        correctCount = 0;
        missCount = 0;
        updateScore(totalTarget);
        document.getElementById('settingsPanel').style.display = 'none';
        document.getElementById('gameArea').style.display = 'block';

        // Add miss tap listener to game area
        document.getElementById('gameArea').addEventListener('touchstart', handleMissTap);
        document.getElementById('gameArea').addEventListener('mousedown', handleMissTap);

        countdownOverlay(3, () => {
            isGameRunning = true;
            createNewDot();

            if (gameType === 'time') {
                let timeLeft = totalTarget;
                const interval = setInterval(() => {
                    timeLeft--;
                    updateScore(timeLeft);
                    if (timeLeft <= 0) {
                        clearInterval(interval);
                        endGame();
                    }
                }, 1000);
            }
        });
    }

</script>
</body>
</html>
