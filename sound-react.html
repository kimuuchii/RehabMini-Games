<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Sound Reaction</title>
<script defer src="shared.js"></script>
<style>.msg{font-size:40px;font-weight:800;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,.6)}</style>
</head>
<body>
<div class="container">
  <h1>üîä Sound Reaction</h1>
  <div class="section">
    <div class="section-title">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</div>
    <div class="input-group">
      <label>‡∏£‡∏≠‡∏™‡∏∏‡πà‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡πà‡∏≥ (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)</label>
      <input type="number" id="minSec" min="1" max="10" value="2">
    </div>
    <div class="input-group">
      <label>‡∏£‡∏≠‡∏™‡∏∏‡πà‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏π‡∏á (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)</label>
      <input type="number" id="maxSec" min="2" max="20" value="6">
    </div>
    <div class="checkbox-group">
      <div class="checkbox-item"><input type="checkbox" id="sayGo"><label for="sayGo">‡∏û‡∏π‡∏î‡∏ß‡πà‡∏≤ ‚Äú‡πÅ‡∏ï‡∏∞!‚Äù</label></div>
      <div class="checkbox-item"><input type="checkbox" id="beep" checked><label for="beep">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ö‡∏µ‡πä‡∏ö</label></div>
    </div>
    <div class="button-group">
      <button class="btn-primary" id="startBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°</button>
      <a class="btn-secondary" href="index.html" style="text-align:center;display:block">‚Ü©Ô∏é ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Å‡∏°</a>
    </div>
  </div>
</div>

<div class="play-screen" id="play" style="background:#7f1d1d">
  <button class="close-btn" id="close">‡∏õ‡∏¥‡∏î</button>
  <div class="msg" id="msg">‡∏£‡∏≠...</div>
</div>

<script>
let state='idle', startTs=0, waitT=null;
const play=$('#play'), msg=$('#msg');

function toWaiting(){
  play.classList.add('active'); state='waiting';
  play.style.background='#7f1d1d'; msg.textContent='‡∏£‡∏≠...';
  const min=+$('#minSec').value*1000, max=+$('#maxSec').value*1000;
  const delay=Math.floor(Math.random()*(Math.max(max,min+1000)-min))+min;
  clearTimeout(waitT); waitT=setTimeout(go, delay);
}
function go(){
  if($('#beep').checked) beep(880,0.12,0.2);
  if($('#sayGo').checked) speak('‡πÅ‡∏ï‡∏∞!');
  play.style.background='#065f46'; msg.textContent='‡πÑ‡∏õ!';
  state='go'; startTs=performance.now();
}
$('#startBtn').onclick=toWaiting;
$('#close').onclick=()=>{ play.classList.remove('active'); state='idle'; clearTimeout(waitT); };
play.addEventListener('touchstart', onTap, {passive:true});
play.addEventListener('click', onTap);
function onTap(){
  if(state==='waiting'){ toast('‡πÄ‡∏£‡πá‡∏ß‡πÑ‡∏õ! ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà'); toWaiting(); return; }
  if(state==='go'){
    const rt=Math.round(performance.now()-startTs);
    msg.textContent=`‡πÄ‡∏ß‡∏•‡∏≤: ${rt} ms`; toast(`Reaction: ${rt} ms`); state='idle';
    setTimeout(toWaiting,1000);
  }
}
</script>
</body>
</html>
