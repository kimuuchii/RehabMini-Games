<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Sound Reaction | ‡∏ù‡∏∂‡∏Å‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏á</title>
    <style>
        /* Shared & Base Styles */
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap');
        :root {
            --color-blue: #007AFF;
            --color-green: #34C759;
            --color-bg: #f0f0f0;
            --font-family: 'Sarabun', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        body {
            font-family: var(--font-family);
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
            background-color: var(--color-bg);
        }
        .settings-panel, .result-panel {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 90%;
            text-align: left;
        }
        h2 { color: var(--color-blue); font-size: 2rem; margin-top: 0; text-align: center; }
        label { display: block; margin-bottom: 15px; font-size: 1.2rem; font-weight: 700; }
        input[type="number"] { width: 100%; padding: 10px; margin-top: 5px; border: 2px solid #ccc; border-radius: 8px; font-size: 1.1rem; box-sizing: border-box; }
        .start-button, .home-button {
            background-color: var(--color-green);
            color: white;
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1.8rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.15s;
        }
        .home-button { background-color: var(--color-blue); margin-top: 10px; font-size: 1.4rem; }
        .start-button:active, .home-button:active { transform: translateY(2px); }

        /* Game Display Styles */
        #gameArea {
            display: none;
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            background-color: #333; /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏°‡∏∑‡∏î‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏≠ */
            color: white;
            justify-content: center;
            align-items: center;
            font-size: 3rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #gameArea.ready { background-color: #FF3B30; } /* ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡∏∞ */
        #resultDisplay {
            font-size: 2rem;
            font-weight: 700;
            margin-top: 20px;
        }
    </style>
    <script src="shared.js"></script>
</head>
<body>
    <div class="settings-panel" id="settingsPanel">
        <button class="home-button" onclick="goTo('index.html')">üè† ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
        <h2>üîä Sound Reaction Setup</h2>
        
        <label for="rounds">üéØ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô:</label>
        <input type="number" id="rounds" value="10" min="1" max="50">

        <label for="waitTimeMin">‚è±Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≠‡∏™‡∏∏‡πà‡∏°‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ):</label>
        <input type="number" id="waitTimeMin" value="2" min="1" max="5">

        <label for="waitTimeMax">‚è±Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≠‡∏™‡∏∏‡πà‡∏°‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ):</label>
        <input type="number" id="waitTimeMax" value="6" min="3" max="10">
        
        <button class="start-button" onclick="startGame()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
    </div>

    <div id="gameArea">
        <span id="gameText">‡∏£‡∏≠‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì...</span>
    </div>

    <div class="result-panel" id="resultPanel" style="display: none;">
        <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å</h2>
        <div id="resultDisplay"></div>
        <button class="start-button" onclick="window.location.reload()">‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
        <button class="home-button" onclick="goTo('index.html')">üè† ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
    </div>

<script>
    let totalRounds = 0;
    let currentRound = 0;
    let reactionTimes = [];
    let waitTimeout;
    let startTime;
    let gameReady = false;
    let gameStarted = false;

    function resetGameArea() {
        document.getElementById('gameArea').classList.remove('ready');
        document.getElementById('gameText').textContent = '‡∏£‡∏≠‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì...';
        gameReady = false;
    }

    function showResult() {
        gameStarted = false;
        document.getElementById('gameArea').style.display = 'none';
        
        let avgTime = 0;
        if (reactionTimes.length > 0) {
            const sum = reactionTimes.reduce((a, b) => a + b, 0);
            avgTime = (sum / reactionTimes.length).toFixed(0);
        }

        document.getElementById('resultDisplay').innerHTML = `
            <p><strong>‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô:</strong> ${currentRound} ‡∏£‡∏≠‡∏ö</p>
            <p><strong>‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ Reaction Time:</strong> <span style="font-size: 3rem; color: ${avgTime < 400 ? var(--color-green) : var(--color-blue)};">${avgTime}</span> ms</p>
            <p>(‡∏¢‡∏¥‡πà‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏¢‡∏¥‡πà‡∏á‡∏î‡∏µ)</p>
        `;
        document.getElementById('resultPanel').style.display = 'block';
        beep(2);
    }

    function nextRound() {
        if (currentRound >= totalRounds) {
            showResult();
            return;
        }
        currentRound++;
        resetGameArea();
        
        const min = parseFloat(document.getElementById('waitTimeMin').value) * 1000;
        const max = parseFloat(document.getElementById('waitTimeMax').value) * 1000;
        const waitTime = Math.random() * (max - min) + min;

        waitTimeout = setTimeout(() => {
            // ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì "‡πÅ‡∏ï‡∏∞!"
            beep(2);
            speak("‡πÅ‡∏ï‡∏∞!");
            document.getElementById('gameArea').classList.add('ready');
            document.getElementById('gameText').textContent = '‡πÅ‡∏ï‡∏∞‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ô‡∏µ‡πâ!';
            startTime = Date.now();
            gameReady = true;
        }, waitTime);
    }

    function handleTap() {
        if (!gameStarted) return; // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡∏∞‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°

        if (gameReady) {
            // ‡πÅ‡∏ï‡∏∞‡∏ñ‡∏π‡∏Å
            const reactionTime = Date.now() - startTime;
            reactionTimes.push(reactionTime);
            toast(`‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà ${currentRound}: ${reactionTime} ms`);
            nextRound();
        } else {
            // ‡πÅ‡∏ï‡∏∞‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
            clearTimeout(waitTimeout);
            toast('‡πÄ‡∏£‡πá‡∏ß‡πÑ‡∏õ! ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ï‡∏∞‡∏Å‡πà‡∏≠‡∏ô‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì');
            speak('‡πÄ‡∏£‡πá‡∏ß‡πÑ‡∏õ!');
            // ‡∏ô‡∏±‡∏ö‡∏£‡∏≠‡∏ö‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô miss ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ô‡∏±‡∏ö‡∏Å‡πá‡πÑ‡∏î‡πâ, ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏à‡∏∞‡∏ô‡∏±‡∏ö‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà
            nextRound(); 
        }
    }

    function startGame() {
        totalRounds = parseInt(document.getElementById('rounds').value);
        if (isNaN(totalRounds) || totalRounds < 1) {
            toast('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≠‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÅ‡∏•‡∏∞‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0');
            return;
        }

        document.getElementById('settingsPanel').style.display = 'none';
        document.getElementById('gameArea').style.display = 'flex';
        document.getElementById('gameArea').addEventListener('touchstart', handleTap);
        document.getElementById('gameArea').addEventListener('mousedown', handleTap);

        countdownOverlay(3, () => {
            gameStarted = true;
            nextRound();
        });
    }

</script>
</body>
</html>
