<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>üîä Sound Reaction Game</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'Sarabun', -apple-system, sans-serif;
  background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  -webkit-tap-highlight-color: transparent;
  overflow: hidden;
}
.container {
  text-align: center;
  padding: 20px;
  max-width: 500px;
  width: 100%;
}
.back-btn {
  position: absolute;
  top: 20px;
  left: 20px;
  background: rgba(255,255,255,0.2);
  backdrop-filter: blur(10px);
  border: none;
  padding: 12px 20px;
  border-radius: 10px;
  color: white;
  font-size: 1.1rem;
  cursor: pointer;
}
h1 { font-size: 2.5rem; margin-bottom: 20px; }
.status {
  font-size: 1.5rem;
  margin: 30px 0;
  min-height: 2em;
  font-weight: 600;
}
.tap-area {
  width: 100%;
  aspect-ratio: 1;
  max-width: 350px;
  margin: 30px auto;
  border-radius: 50%;
  background: rgba(255,255,255,0.2);
  backdrop-filter: blur(10px);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 4rem;
  cursor: pointer;
  transition: all 0.2s;
  border: 4px solid rgba(255,255,255,0.3);
}
.tap-area:active {
  transform: scale(0.95);
  background: rgba(255,255,255,0.3);
}
.tap-area.ready {
  background: #34C759;
  border-color: #2fb34f;
  animation: pulse 0.5s ease infinite;
}
.results {
  background: rgba(255,255,255,0.15);
  backdrop-filter: blur(10px);
  border-radius: 15px;
  padding: 20px;
  margin: 20px 0;
  font-size: 1.2rem;
}
.result-item {
  margin: 8px 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.result-value {
  font-weight: bold;
  font-size: 1.4rem;
}
.btn {
  width: 100%;
  max-width: 300px;
  padding: 18px;
  font-size: 1.3rem;
  font-weight: 600;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  margin: 10px auto;
  display: block;
  transition: all 0.2s;
}
.btn-primary {
  background: white;
  color: #11998e;
}
.btn-secondary {
  background: rgba(255,255,255,0.2);
  color: white;
}
.btn:active {
  transform: scale(0.95);
}
@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}
</style>
</head>
<body>

<button class="back-btn" onclick="window.location.href='index.html'">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>

<div class="container">
  <h1>üîä Sound Reaction</h1>
  
  <div class="status" id="status">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</div>
  
  <div class="tap-area" id="tapArea" onclick="handleTap()">
    <span id="tapIcon">üëÇ</span>
  </div>
  
  <div class="results" id="results" style="display:none;"></div>
  
  <button class="btn btn-primary" id="startBtn" onclick="startRound()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
  <button class="btn btn-secondary" onclick="window.location.href='index.html'">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
</div>

<script src="shared.js"></script>
<script>
let waiting = false;
let canTap = false;
let startTime = 0;
let reactionTimes = [];
let roundCount = 0;
const maxRounds = 5;

function startRound() {
  if (roundCount >= maxRounds) {
    showFinalResults();
    return;
  }
  
  document.getElementById('startBtn').style.display = 'none';
  document.getElementById('results').style.display = 'none';
  document.getElementById('status').textContent = '‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß...';
  document.getElementById('tapArea').className = 'tap-area';
  document.getElementById('tapIcon').textContent = 'üëÇ';
  
  waiting = true;
  canTap = false;
  
  const delay = 2000 + Math.random() * 4000;
  
  setTimeout(() => {
    if (!waiting) return;
    
    canTap = true;
    startTime = Date.now();
    document.getElementById('status').textContent = '‡πÅ‡∏ï‡∏∞‡πÄ‡∏•‡∏¢!';
    document.getElementById('tapArea').classList.add('ready');
    document.getElementById('tapIcon').textContent = 'üëÜ';
    
    speak('‡πÅ‡∏ï‡∏∞');
    beep(1000, 200);
  }, delay);
}

function handleTap() {
  if (!waiting) return;
  
  if (!canTap) {
    // ‡πÅ‡∏ï‡∏∞‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
    waiting = false;
    document.getElementById('status').textContent = '‚ùå ‡πÄ‡∏£‡πá‡∏ß‡πÑ‡∏õ!';
    document.getElementById('tapArea').className = 'tap-area';
    document.getElementById('tapIcon').textContent = '‚ö†Ô∏è';
    toast('‡πÅ‡∏ï‡∏∞‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏£‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞');
    
    setTimeout(() => {
      document.getElementById('status').textContent = '‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà';
      document.getElementById('startBtn').style.display = 'block';
      document.getElementById('startBtn').textContent = '‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà';
    }, 1500);
  } else {
    // ‡πÅ‡∏ï‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
    const reactionTime = Date.now() - startTime;
    reactionTimes.push(reactionTime);
    roundCount++;
    waiting = false;
    canTap = false;
    
    document.getElementById('status').textContent = `‚ö° ${reactionTime} ms`;
    document.getElementById('tapArea').className = 'tap-area';
    document.getElementById('tapIcon').textContent = '‚úì';
    
    setTimeout(() => {
      if (roundCount < maxRounds) {
        document.getElementById('status').textContent = `‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà ${roundCount + 1}/${maxRounds}`;
        document.getElementById('startBtn').textContent = '‡∏£‡∏≠‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ';
        document.getElementById('startBtn').style.display = 'block';
      } else {
        showFinalResults();
      }
    }, 1500);
  }
}

function showFinalResults() {
  if (reactionTimes.length === 0) {
    toast('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô');
    return;
  }
  
  const avg = Math.round(reactionTimes.reduce((a, b) => a + b, 0) / reactionTimes.length);
  const best = Math.min(...reactionTimes);
  const worst = Math.max(...reactionTimes);
  
  const resultsHTML = `
    <div class="result-item">
      <span>‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢:</span>
      <span class="result-value">${avg} ms</span>
    </div>
    <div class="result-item">
      <span>‡πÄ‡∏£‡πá‡∏ß‡∏™‡∏∏‡∏î:</span>
      <span class="result-value">${best} ms</span>
    </div>
    <div class="result-item">
      <span>‡∏ä‡πâ‡∏≤‡∏™‡∏∏‡∏î:</span>
      <span class="result-value">${worst} ms</span>
    </div>
  `;
  
  document.getElementById('results').innerHTML = resultsHTML;
  document.getElementById('results').style.display = 'block';
  document.getElementById('status').textContent = 'üéâ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!';
  document.getElementById('startBtn').textContent = '‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà';
  document.getElementById('startBtn').style.display = 'block';
  
  // Reset
  reactionTimes = [];
  roundCount = 0;
  
  toast('‡∏ù‡∏∂‡∏Å‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!', 3000);
}
</script>

</body>
</html>
