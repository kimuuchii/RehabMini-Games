<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Direction Tap | ‡πÄ‡∏Å‡∏°‡πÅ‡∏ï‡∏∞‡∏ï‡∏≤‡∏°‡∏ó‡∏¥‡∏®</title>
    <style>
        /* Shared & Base Styles */
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap');
        :root {
            --color-blue: #007AFF;
            --color-green: #34C759;
            --color-red: #FF3B30;
            --color-bg: #f0f0f0;
            --font-family: 'Sarabun', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        body {
            font-family: var(--font-family);
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
            background-color: var(--color-bg);
        }
        .settings-panel, .result-panel {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 90%;
            text-align: left;
        }
        h2 { color: var(--color-blue); font-size: 2rem; margin-top: 0; text-align: center; }
        label { display: block; margin-bottom: 15px; font-size: 1.2rem; font-weight: 700; }
        select { width: 100%; padding: 10px; margin-top: 5px; border: 2px solid #ccc; border-radius: 8px; font-size: 1.1rem; box-sizing: border-box; }
        .start-button, .home-button {
            background-color: var(--color-green);
            color: white;
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1.8rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.15s;
        }
        .home-button { background-color: var(--color-blue); margin-top: 10px; font-size: 1.4rem; }
        .start-button:active, .home-button:active { transform: translateY(2px); }

        /* Game Area */
        #gameArea {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: white;
            color: #333;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        #arrowDisplay {
            font-size: 15vw; /* ‡πÉ‡∏´‡∏ç‡πà‡∏°‡∏≤‡∏Å */
            margin-bottom: 50px;
            transform: rotate(0deg);
            transition: transform 0.3s ease-out;
            font-weight: 900;
            color: #333;
        }
        .direction-buttons {
            display: grid;
            grid-template-areas: ". up ." "left center right" ". down .";
            width: 90vw;
            max-width: 500px;
            gap: 10px;
        }
        .dir-button {
            background-color: var(--color-blue);
            color: white;
            padding: 20px;
            border-radius: 10px;
            font-size: 2rem;
            font-weight: 700;
            cursor: pointer;
            user-select: none;
            transition: all 0.1s;
            line-height: 1;
        }
        .dir-button:active {
            opacity: 0.8;
            transform: scale(0.98);
        }
        #btnUp { grid-area: up; }
        #btnDown { grid-area: down; }
        #btnLeft { grid-area: left; }
        #btnRight { grid-area: right; }
        
        .score-display {
            position: fixed;
            top: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 1.2rem;
            z-index: 10;
        }
        .result-panel .correct { color: var(--color-green); font-size: 2rem; }
        .result-panel .miss { color: var(--color-red); font-size: 2rem; }
    </style>
    <script src="shared.js"></script>
</head>
<body>
    <div class="settings-panel" id="settingsPanel">
        <button class="home-button" onclick="goTo('index.html')">üè† ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
        <h2>üß≠ Direction Tap Setup</h2>
        
        <label for="mode">‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏Å‡∏°:</label>
        <select id="mode">
            <option value="straight">‡∏ï‡∏£‡∏á‡πÑ‡∏õ‡∏ï‡∏£‡∏á‡∏°‡∏≤ (‡∏†‡∏≤‡∏û = ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á)</option>
            <option value="stroop">‡∏´‡∏•‡∏≠‡∏Å‡∏™‡∏°‡∏≠‡∏á (‡πÅ‡∏ï‡∏∞‡∏ï‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏á!)</option>
        </select>

        <label for="rounds">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô:</label>
        <input type="number" id="rounds" value="20" min="5" max="50">
        
        <button class="start-button" onclick="startGame()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
    </div>

    <div id="gameArea">
        <div class="score-display">
            ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: <span id="correctScore">0</span> | ‡∏ú‡∏¥‡∏î: <span id="missScore">0</span> | ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà <span id="currentRound">0</span>
        </div>
        <div id="arrowDisplay"></div>
        <div class="direction-buttons">
            <div class="dir-button" id="btnUp" data-dir="up">‚¨ÜÔ∏è</div>
            <div class="dir-button" id="btnLeft" data-dir="left">‚¨ÖÔ∏è</div>
            <div class="dir-button" id="btnRight" data-dir="right">‚û°Ô∏è</div>
            <div class="dir-button" id="btnDown" data-dir="down">‚¨áÔ∏è</div>
        </div>
    </div>

    <div class="result-panel" id="resultPanel" style="display: none;">
        <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å</h2>
        <p>‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: <span id="finalCorrect" class="correct"></span></p>
        <p>‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: <span id="finalMiss" class="miss"></span></p>
        <button class="start-button" onclick="window.location.reload()">‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
        <button class="home-button" onclick="goTo('index.html')">üè† ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
    </div>

<script>
    const DIRECTIONS = {
        up: { text: '‡∏Ç‡∏∂‡πâ‡∏ô', arrow: '‚Üë', angle: 0 },
        down: { text: '‡∏•‡∏á', arrow: '‚Üì', angle: 180 },
        left: { text: '‡∏ã‡πâ‡∏≤‡∏¢', arrow: '‚Üê', angle: -90 },
        right: { text: '‡∏Ç‡∏ß‡∏≤', arrow: '‚Üí', angle: 90 }
    };
    let totalRounds = 0;
    let currentRound = 0;
    let correctCount = 0;
    let missCount = 0;
    let isGameRunning = false;
    let gameMode = 'straight';
    let currentCommand = ''; // ‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á (‡∏à‡∏≤‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á)
    let currentArrow = ''; // ‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏®‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏´‡πá‡∏ô

    function getRandomDirectionKey() {
        const keys = Object.keys(DIRECTIONS);
        return keys[Math.floor(Math.random() * keys.length)];
    }

    function generateRound() {
        if (currentRound >= totalRounds) {
            endGame();
            return;
        }

        currentRound++;
        isGameRunning = false; // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡∏∞‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏≠

        let commandKey = getRandomDirectionKey();
        let arrowKey = commandKey; 

        if (gameMode === 'stroop') {
            // ‡πÇ‡∏´‡∏°‡∏î‡∏´‡∏•‡∏≠‡∏Å‡∏™‡∏°‡∏≠‡∏á: 50% ‡∏†‡∏≤‡∏û‡∏Å‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô
            if (Math.random() < 0.5) {
                // ‡∏´‡∏•‡∏≠‡∏Å! ‡πÉ‡∏´‡πâ‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á
                do {
                    arrowKey = getRandomDirectionKey();
                } while (arrowKey === commandKey);
            }
        }

        currentCommand = commandKey;
        currentArrow = arrowKey;

        // Display Arrow
        const arrowEl = document.getElementById('arrowDisplay');
        arrowEl.textContent = DIRECTIONS[arrowKey].arrow;
        // arrowEl.style.transform = `rotate(${DIRECTIONS[arrowKey].angle}deg)`;

        // Speak Command
        setTimeout(() => {
            speak(DIRECTIONS[commandKey].text);
            isGameRunning = true; // ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö input ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î
        }, 500); // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏î‡∏π‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á
        
        updateScore();
    }

    function updateScore() {
        document.getElementById('correctScore').textContent = correctCount;
        document.getElementById('missScore').textContent = missCount;
        document.getElementById('currentRound').textContent = currentRound;
    }

    function handleTap(event) {
        if (!isGameRunning) return;
        
        const tappedDir = event.currentTarget.dataset.dir;

        if (tappedDir === currentCommand) {
            // ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
            correctCount++;
            toast('‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!');
        } else {
            // ‡∏ú‡∏¥‡∏î
            missCount++;
            toast('‚ùå ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!');
            beep(1);
        }
        
        // ‡∏à‡∏ö‡∏£‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏£‡∏≠‡∏ö‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        generateRound();
    }

    function endGame() {
        isGameRunning = false;
        beep(2);
        document.getElementById('gameArea').style.display = 'none';
        document.getElementById('finalCorrect').textContent = correctCount;
        document.getElementById('finalMiss').textContent = missCount;
        document.getElementById('resultPanel').style.display = 'block';
    }

    function setupButtons() {
        document.querySelectorAll('.dir-button').forEach(btn => {
            btn.removeEventListener('touchstart', handleTap);
            btn.removeEventListener('mousedown', handleTap);
            btn.addEventListener('touchstart', handleTap, { passive: true });
            btn.addEventListener('mousedown', handleTap);
        });
    }

    function startGame() {
        totalRounds = parseInt(document.getElementById('rounds').value);
        gameMode = document.getElementById('mode').value;
        if (isNaN(totalRounds) || totalRounds < 1) {
            toast('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≠‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÅ‡∏•‡∏∞‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0');
            return;
        }

        // Reset
        currentRound = 0;
        correctCount = 0;
        missCount = 0;
        
        document.getElementById('settingsPanel').style.display = 'none';
        document.getElementById('gameArea').style.display = 'flex';
        setupButtons();

        countdownOverlay(3, () => {
            generateRound(); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡πÅ‡∏£‡∏Å
        });
    }

</script>
</body>
</html>
