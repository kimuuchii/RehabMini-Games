<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Rehab Mini-Games</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Sarabun", sans-serif;
            background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
            min-height: 100vh;
            touch-action: manipulation;
            overflow-x: hidden;
        }

        .container {
            padding: 20px;
            max-width: 500px;
            margin: 0 auto;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding-top: 20px;
        }

        .header h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .games-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 40px;
        }

        .game-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .game-card:active {
            transform: scale(0.98);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .game-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #007AFF, #5856D6);
        }

        .game-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .game-emoji {
            font-size: 24px;
        }

        .game-description {
            font-size: 14px;
            color: #666;
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .game-stats {
            font-size: 12px;
            color: #007AFF;
            font-weight: 500;
            background: #F0F8FF;
            padding: 6px 12px;
            border-radius: 20px;
            display: inline-block;
        }

        .stats-section {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .stats-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 16px;
            text-align: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .stat-item {
            text-align: center;
            padding: 16px;
            background: #F8F9FA;
            border-radius: 12px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #007AFF;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }

        .footer {
            text-align: center;
            color: white;
            opacity: 0.8;
            font-size: 14px;
            margin-top: 40px;
            padding-bottom: 20px;
        }

        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.2s;
        }

        .fullscreen-btn:active {
            background: rgba(255,255,255,0.3);
            transform: scale(0.95);
        }
    </style>
</head>
<body>
    <button class="fullscreen-btn" onclick="toggleFullscreen()" title="‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠">‚õ∂</button>
    
    <div class="container">
        <div class="header">
            <h1>üß† Rehab Mini-Games</h1>
            <p>‡∏ù‡∏∂‡∏Å‡∏™‡∏°‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</p>
        </div>

        <div class="stats-section">
            <div class="stats-title">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏ß‡∏°</div>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="totalGames">0</div>
                    <div class="stat-label">‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="avgAccuracy">0%</div>
                    <div class="stat-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalTime">0</div>
                    <div class="stat-label">‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="streak">0</div>
                    <div class="stat-label">‡∏ß‡∏±‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</div>
                </div>
            </div>
        </div>

        <div class="games-grid">
            <div class="game-card" onclick="goToGame('color-cue')">
                <div class="game-title">
                    <span class="game-emoji">üé®</span>
                    Color Cue Trainer
                </div>
                <div class="game-description">‡∏ù‡∏∂‡∏Å‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡∏ï‡πà‡∏≠‡∏™‡∏µ‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏µ</div>
                <div class="game-stats" id="color-cue-stats">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏•‡πà‡∏ô</div>
            </div>

            <div class="game-card" onclick="goToGame('sound-react')">
                <div class="game-title">
                    <span class="game-emoji">üîä</span>
                    Sound Reaction
                </div>
                <div class="game-description">‡∏ù‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏á</div>
                <div class="game-stats" id="sound-react-stats">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏•‡πà‡∏ô</div>
            </div>

            <div class="game-card" onclick="goToGame('follow-dot')">
                <div class="game-title">
                    <span class="game-emoji">üëÜ</span>
                    Follow the Dot
                </div>
                <div class="game-description">‡∏ù‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡∏≤</div>
                <div class="game-stats" id="follow-dot-stats">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏•‡πà‡∏ô</div>
            </div>

            <div class="game-card" onclick="goToGame('memory')">
                <div class="game-title">
                    <span class="game-emoji">üß©</span>
                    Memory Pattern
                </div>
                <div class="game-description">‡∏ù‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏Å‡∏°‡∏à‡∏≥‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏™‡∏µ</div>
                <div class="game-stats" id="memory-stats">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏•‡πà‡∏ô</div>
            </div>

            <div class="game-card" onclick="goToGame('direction')">
                <div class="game-title">
                    <span class="game-emoji">‚ÜîÔ∏è</span>
                    Direction Tap
                </div>
                <div class="game-description">‡∏ù‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á</div>
                <div class="game-stats" id="direction-stats">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏•‡πà‡∏ô</div>
            </div>
        </div>

        <div class="footer">
            <p>üí° ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠</p>
        </div>
    </div>

    <script src="shared.js"></script>
    <script>
        const GAMES = [
            { id: 'color-cue', name: 'Color Cue Trainer', emoji: 'üé®' },
            { id: 'sound-react', name: 'Sound Reaction', emoji: 'üîä' },
            { id: 'follow-dot', name: 'Follow the Dot', emoji: 'üëÜ' },
            { id: 'memory', name: 'Memory Pattern', emoji: 'üß©' },
            { id: 'direction', name: 'Direction Tap', emoji: '‚ÜîÔ∏è' }
        ];

        function goToGame(gameId) {
            window.location.href = `${gameId}.html`;
        }

        function updateStats() {
            const stats = getStats();
            let totalGames = 0;
            let totalAccuracy = 0;
            let totalTime = 0;
            let accuracyCount = 0;

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏Å‡∏°
            GAMES.forEach(game => {
                const gameStats = stats[game.id];
                const statsElement = document.getElementById(`${game.id}-stats`);
                
                if (gameStats && gameStats.lastPlayed) {
                    const lastPlayed = formatLastPlayed(gameStats.lastPlayed);
                    let accuracy = '';
                    
                    if (gameStats.accuracy !== undefined) {
                        accuracy = ` ‚Äî ‡∏ñ‡∏π‡∏Å ${gameStats.accuracy}%`;
                        totalAccuracy += gameStats.accuracy;
                        accuracyCount++;
                    }
                    
                    statsElement.textContent = `üéØ ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${lastPlayed}${accuracy}`;
                    
                    if (gameStats.rounds) totalGames += gameStats.rounds;
                    if (gameStats.totalTime) totalTime += gameStats.totalTime;
                } else {
                    statsElement.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏•‡πà‡∏ô';
                }
            });

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏ß‡∏°
            document.getElementById('totalGames').textContent = totalGames;
            document.getElementById('avgAccuracy').textContent = 
                accuracyCount > 0 ? `${Math.round(totalAccuracy / accuracyCount)}%` : '0%';
            document.getElementById('totalTime').textContent = Math.round(totalTime / 60);
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì streak (‡∏ß‡∏±‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠)
            const today = new Date().toDateString();
            const yesterday = new Date(Date.now() - 24 * 60 * 60 * 1000).toDateString();
            let streak = 0;
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            const hasPlayedToday = Object.values(stats).some(gameStats => {
                if (!gameStats.lastPlayed) return false;
                const lastPlayedDate = new Date(gameStats.lastPlayed).toDateString();
                return lastPlayedDate === today;
            });
            
            if (hasPlayedToday) {
                streak = 1;
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
                for (let i = 1; i < 30; i++) {
                    const checkDate = new Date(Date.now() - i * 24 * 60 * 60 * 1000).toDateString();
                    const hasPlayedOnDate = Object.values(stats).some(gameStats => {
                        if (!gameStats.lastPlayed) return false;
                        const lastPlayedDate = new Date(gameStats.lastPlayed).toDateString();
                        return lastPlayedDate === checkDate;
                    });
                    
                    if (hasPlayedOnDate) {
                        streak++;
                    } else {
                        break;
                    }
                }
            }
            
            document.getElementById('streak').textContent = streak;
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        window.addEventListener('load', () => {
            initGame();
            updateStats();
        });
    </script>
</body>
</html>
