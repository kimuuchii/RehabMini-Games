<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>üß† Memory Pattern</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    body {
      font-family: 'Sarabun', -apple-system, system-ui, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      color: white;
    }
    .container {
      width: 100%;
      max-width: 500px;
    }
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    .header h1 {
      font-size: 2.2em;
      margin-bottom: 10px;
    }
    .info-box {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 20px;
      text-align: center;
      margin-bottom: 30px;
    }
    .level-display {
      font-size: 2em;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .instruction {
      font-size: 1.1em;
      opacity: 0.9;
    }
    .color-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 30px;
    }
    .color-btn {
      aspect-ratio: 1;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
    }
    .color-btn:active {
      transform: scale(0.95);
    }
    .color-btn.active {
      transform: scale(1.15);
      box-shadow: 0 0 30px currentColor, 0 0 60px currentColor;
      filter: brightness(1.5);
    }
    .color-btn.red {
      background: #FF3B30;
    }
    .color-btn.yellow {
      background: #FFCC00;
    }
    .color-btn.green {
      background: #34C759;
    }
    .color-btn.blue {
      background: #007AFF;
    }
    .color-btn.disabled {
      opacity: 0.5;
      pointer-events: none;
    }
    .btn {
      width: 100%;
      padding: 18px;
      font-size: 1.3em;
      font-weight: 600;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 10px;
    }
    .btn-primary {
      background: white;
      color: #667eea;
    }
    .btn-primary:active {
      transform: scale(0.95);
    }
    .btn-secondary {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      backdrop-filter: blur(10px);
    }
  </style>
  <style id="shared-styles"></style>
  <script src="shared.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üß† Memory Pattern</h1>
      <p>‡∏ù‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏™‡∏µ</p>
    </div>

    <div class="info-box">
      <div class="level-display" id="levelDisplay">‡∏£‡∏∞‡∏î‡∏±‡∏ö 1</div>
      <div class="instruction" id="instruction">‡∏Å‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</div>
    </div>

    <div class="color-grid">
      <button class="color-btn red disabled" id="red" onclick="playerTap('red')"></button>
      <button class="color-btn yellow disabled" id="yellow" onclick="playerTap('yellow')"></button>
      <button class="color-btn green disabled" id="green" onclick="playerTap('green')"></button>
      <button class="color-btn blue disabled" id="blue" onclick="playerTap('blue')"></button>
    </div>

    <button class="btn btn-primary" id="startBtn" onclick="startGame()">üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
    <button class="btn btn-secondary" onclick="location.href='index.html'">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
  </div>

  <script>
    const colors = ['red', 'yellow', 'green', 'blue'];
    const colorNames = {
      red: '‡πÅ‡∏î‡∏á',
      yellow: '‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á',
      green: '‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß',
      blue: '‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô'
    };
    const colorFreq = {
      red: 400,
      yellow: 500,
      green: 600,
      blue: 700
    };

    let sequence = [];
    let playerSequence = [];
    let level = 1;
    let gameActive = false;
    let showingSequence = false;

    async function startGame() {
      document.getElementById('startBtn').style.display = 'none';
      sequence = [];
      level = 1;
      gameActive = true;

      await countdownOverlay(3);
      nextRound();
    }

    async function nextRound() {
      playerSequence = [];
      sequence.push(colors[Math.floor(Math.random() * colors.length)]);
      
      document.getElementById('levelDisplay').textContent = `‡∏£‡∏∞‡∏î‡∏±‡∏ö ${level}`;
      document.getElementById('instruction').textContent = '‡∏à‡∏î‡∏à‡∏≥‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏™‡∏µ...';
      
      disableButtons();
      await new Promise(resolve => setTimeout(resolve, 1000));
      await showSequence();
      
      document.getElementById('instruction').textContent = '‡πÅ‡∏ï‡∏∞‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏´‡πá‡∏ô!';
      enableButtons();
    }

    async function showSequence() {
      showingSequence = true;
      
      for (let i = 0; i < sequence.length; i++) {
        await new Promise(resolve => setTimeout(resolve, 300));
        await flashColor(sequence[i]);
      }
      
      showingSequence = false;
    }

    function flashColor(color) {
      return new Promise(resolve => {
        const btn = document.getElementById(color);
        btn.classList.add('active');
        
        beep(colorFreq[color], 400);
        speak(colorNames[color]);
        
        setTimeout(() => {
          btn.classList.remove('active');
          resolve();
        }, 700);
      });
    }

    function playerTap(color) {
      if (showingSequence || !gameActive) return;
      
      playerSequence.push(color);
      
      const btn = document.getElementById(color);
      btn.classList.add('active');
      beep(colorFreq[color], 200);
      
      setTimeout(() => {
        btn.classList.remove('active');
      }, 300);
      
      checkSequence();
    }

    function checkSequence() {
      const currentIndex = playerSequence.length - 1;
      
      if (playerSequence[currentIndex] !== sequence[currentIndex]) {
        gameOver();
        return;
      }
      
      if (playerSequence.length === sequence.length) {
        level++;
        toast('‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!', 1500);
        setTimeout(() => nextRound(), 2000);
      }
    }

    function gameOver() {
      gameActive = false;
      disableButtons();
      
      document.getElementById('instruction').textContent = `‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î! ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ ${level} ‡∏£‡∏∞‡∏î‡∏±‡∏ö`;
      
      toast('‚ùå ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!', 2000);
      beep(200, 500);
      
      setTimeout(() => {
        document.getElementById('startBtn').style.display = 'block';
        document.getElementById('startBtn').textContent = '‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
        document.getElementById('instruction').textContent = '‡∏Å‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà';
      }, 2500);
    }

    function disableButtons() {
      colors.forEach(color => {
        document.getElementById(color).classList.add('disabled');
      });
    }

    function enableButtons() {
      colors.forEach(color => {
        document.getElementById(color).classList.remove('disabled');
      });
    }
  </script>
  <script>
    document.getElementById('shared-styles').textContent = sharedStyles;
  </script>
</body>
</html>
